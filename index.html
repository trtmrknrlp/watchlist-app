<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Watchlist (Firebase)</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#071023;--card:#0f1724;--accent:#00c896;--muted:#93a1b0}
    body{margin:0;font-family:'Poppins',sans-serif;background:linear-gradient(180deg,#071025 0%,#0b1220 100%);color:#e6eef6;min-height:100vh}
    header{display:flex;align-items:center;gap:16px;padding:16px 20px;background:linear-gradient(90deg,#071025,#081229)}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{height:44px;width:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#06a47a);display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{margin:0;font-size:18px}
    .search-wrap{flex:1;max-width:640px}
    .search-wrap input{width:100%;padding:10px 12px;border-radius:10px;border:none;background:#0c1a30;color:inherit}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);color:#022;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    .container{max-width:1100px;margin:20px auto;padding:18px}
    .grid{display:grid;grid-template-columns:1fr 340px;gap:18px}
    .card{background:var(--card);padding:16px;border-radius:12px}
    input[type=text],select{width:100%;padding:8px;border-radius:8px;border:none;background:#061224;color:inherit}
    .list .item{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);margin-bottom:8px}
    .meta{font-size:13px;color:var(--muted)}
    .badge{padding:6px 8px;border-radius:8px;font-weight:600}
    .watched{background:linear-gradient(90deg,#047857,#10b981);color:#04241a}
    .unwatched{background:#2f3545;color:#cfe7df}
    .tabs{display:flex;gap:8px;margin-bottom:12px}
    .tabs button.active{background:var(--accent);color:#022}
    .small{font-size:13px;color:var(--muted)}
    .login-screen{position:fixed;inset:0;background:rgba(0,0,0,0.75);display:flex;align-items:center;justify-content:center;z-index:999}
    .login-box{width:360px;background:#08122a;padding:20px;border-radius:10px}
  </style>
</head>
<body>

  <div class="login-screen" id="loginScreen">
    <div class="login-box card">
      <h2>Güvenli Giriş</h2>
      <input id="email" placeholder="E-posta" />
      <input id="pwd" placeholder="Şifre" type="password" style="margin-top:10px"/>
      <div style="margin-top:12px;display:flex;gap:8px">
        <button id="btnLogin">Giriş</button>
        <button id="btnRegister">Kaydol</button>
      </div>
    </div>
  </div>

  <header>
    <div class="brand"><div class="logo">WL</div><h1>Watchlist</h1></div>
    <div class="search-wrap"><input id="searchInput" placeholder="Ara..." /></div>
    <div class="controls">
      <select id="genreFilter"><option value="">Tüm Türler</option></select>
      <button id="btnAddTop">Yeni</button>
      <button id="btnLogout">Çıkış</button>
    </div>
  </header>

  <div class="container">
    <div class="grid">
      <div>
        <div class="card">
          <div class="tabs">
            <button id="tabMovies" class="active">Filmler</button>
            <button id="tabSeries">Diziler</button>
            <button id="tabWatched">İzlenenler</button>
          </div>
          <div id="mainList" class="list"></div>
        </div>
      </div>

      <aside>
        <div class="card">
          <h3>Yeni / Düzenle</h3>
          <select id="typeSelect"><option value="movie">Film</option><option value="series">Dizi</option></select>
          <input id="nameInput" placeholder="İsim" />
          <input id="linkInput" placeholder="Link" />
          <input id="trailerInput" placeholder="Fragman" />
          <select id="genreInput"><option>Genel</option><option>Aksiyon</option><option>Komedi</option><option>Bilim Kurgu</option></select>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button id="saveBtn">Kaydet</button>
            <button id="clearBtn">Temizle</button>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3>Yedekleme</h3>
          <div style="display:flex;gap:8px;margin-top:6px">
            <button id="exportBtn">Dışa Aktar</button>
            <button id="importBtn">İçe Aktar</button>
          </div>
          <textarea id="jsonArea" style="width:100%;height:120px;margin-top:8px;background:#061224;color:inherit;border:none;padding:8px"></textarea>
        </div>
      </aside>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js';
    import { getDatabase, ref, push, set, onValue, update as fbUpdate, remove } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js';

    const firebaseConfig = {
      apiKey: "AIzaSyC9cTj7TxIJFRaacGpFKpbudhcNSiG0HYY",
      authDomain: "watchlist-app-23575.firebaseapp.com",
      databaseURL: "https://watchlist-app-23575-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "watchlist-app-23575",
      storageBucket: "watchlist-app-23575.firebasestorage.app",
      messagingSenderId: "710175861487",
      appId: "1:710175861487:web:4ba473229b9b607398491a",
      measurementId: "G-Y60MBBH78K"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const loginScreen=document.getElementById('loginScreen');
    const email=document.getElementById('email');
    const pwd=document.getElementById('pwd');
    const btnLogin=document.getElementById('btnLogin');
    const btnRegister=document.getElementById('btnRegister');
    const btnLogout=document.getElementById('btnLogout');
    const nameInput=document.getElementById('nameInput');
    const linkInput=document.getElementById('linkInput');
    const trailerInput=document.getElementById('trailerInput');
    const typeSelect=document.getElementById('typeSelect');
    const genreInput=document.getElementById('genreInput');
    const saveBtn=document.getElementById('saveBtn');
    const clearBtn=document.getElementById('clearBtn');
    const mainList=document.getElementById('mainList');
    const searchInput=document.getElementById('searchInput');
    const genreFilter=document.getElementById('genreFilter');
    const exportBtn=document.getElementById('exportBtn');
    const importBtn=document.getElementById('importBtn');
    const jsonArea=document.getElementById('jsonArea');
    const tabMovies=document.getElementById('tabMovies');
    const tabSeries=document.getElementById('tabSeries');
    const tabWatched=document.getElementById('tabWatched');

    let allItems={};
    let activeTab='movies';

    function showLogin(){loginScreen.style.display='flex';}
    function hideLogin(){loginScreen.style.display='none';}

    btnLogin.onclick=async()=>{
      try{await signInWithEmailAndPassword(auth,email.value,pwd.value);hideLogin();}catch(e){alert(e.message);}
    };
    btnRegister.onclick=async()=>{
      try{await createUserWithEmailAndPassword(auth,email.value,pwd.value);alert('Kayıt tamam. Giriş yap.');}catch(e){alert(e.message);}
    };
    btnLogout.onclick=()=>signOut(auth);

    onAuthStateChanged(auth,u=>{if(u){hideLogin();startRealtime();}else{showLogin();stopRealtime();}});

    const itemsRef=ref(db,'items');
    function startRealtime(){onValue(itemsRef,s=>{allItems=s.val()||{};renderList();populateGenres();});}
    function stopRealtime(){allItems={};renderList();}

    async function saveItem(id,data){if(id){await fbUpdate(ref(db,'items/'+id),data);}else{await set(push(itemsRef),data);}}
    async function deleteItem(id){if(confirm('Silinsin mi?'))await remove(ref(db,'items/'+id));}

    saveBtn.onclick=async()=>{
      const name=nameInput.value.trim();
      if(!name)return alert('İsim gir.');
      const data={name,link:linkInput.value, trailer:trailerInput.value, type:typeSelect.value, genre:genreInput.value||'Genel', watched:false, createdAt:Date.now()};
      const editId=saveBtn.dataset.editId;
      await saveItem(editId||null,data);
      delete saveBtn.dataset.editId;
      saveBtn.textContent='Kaydet';
      nameInput.value=linkInput.value=trailerInput.value='';
      genreInput.value='Genel';
    };
    clearBtn.onclick=()=>{nameInput.value=linkInput.value=trailerInput.value='';};

    tabMovies.onclick=()=>setTab('movies');
    tabSeries.onclick=()=>setTab('series');
    tabWatched.onclick=()=>setTab('watched');
    function setTab(t){activeTab=t;document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));if(t==='movies')tabMovies.classList.add('active');if(t==='series')tabSeries.classList.add('active');if(t==='watched')tabWatched.classList.add('active');renderList();}

    searchInput.oninput=()=>renderList();
    genreFilter.onchange=()=>renderList();

    exportBtn.onclick=()=>{jsonArea.value=JSON.stringify(allItems,null,2);alert('JSON hazır.');};
    importBtn.onclick=async()=>{
      try{const d=JSON.parse(jsonArea.value);await set(itemsRef,d);alert('İçe aktarıldı.');}catch(e){alert('Hata:'+e.message);}
    };

    function populateGenres(){
      const genres=new Set();Object.values(allItems).forEach(x=>genres.add(x.genre||'Genel'));
      const cur=genreFilter.value;
      genreFilter.innerHTML='<option value="">Tüm Türler</option>';
      Array.from(genres).sort().forEach(g=>{const o=document.createElement('option');o.value=g;o.textContent=g;genreFilter.appendChild(o);});
      genreFilter.value=cur;
    }

    function renderList(){
      const arr=Object.entries(allItems).map(([id,v])=>({id,...v}));
      let f=arr.filter(x=>{
        if(activeTab==='movies'&&x.type!=='movie')return false;
        if(activeTab==='series'&&x.type!=='series')return false;
        if(activeTab==='watched'&&!x.watched)return false;
        if(genreFilter.value&&x.genre!==genreFilter.value)return false;
        const q=searchInput.value.toLowerCase();
        return !q||x.name?.toLowerCase().includes(q)||x.genre?.toLowerCase().includes(q);
      }).sort((a,b)=>b.createdAt-a.createdAt);
      mainList.innerHTML=f.length?'':'<div class="small">Kayıt yok.</div>';
      f.forEach(it=>{
        const row=document.createElement('div');row.className='item';
        const left=document.createElement('div');left.style.flex='1';
        left.innerHTML=`<a href="${it.link||'#'}" target="_blank">${it.name}</a><div class="meta">${it.genre} • ${it.type==='movie'?'Film':'Dizi'}</div>`;
        const badge=document.createElement('div');badge.className='badge '+(it.watched?'watched':'unwatched');badge.textContent=it.watched?'İzledim':'İzlenmedi';
        const actions=document.createElement('div');
        const b1=document.createElement('button');b1.textContent=it.watched?'Geri Al':'İzledim';b1.onclick=()=>fbUpdate(ref(db,'items/'+it.id),{watched:!it.watched});
        const b2=document.createElement('button');b2.textContent='Fragman';b2.onclick=()=>it.trailer?window.open(it.trailer):alert('Fragman yok');
        const b3=document.createElement('button');b3.textContent='Düzenle';b3.onclick=()=>{nameInput.value=it.name;linkInput.value=it.link;trailerInput.value=it.trailer;typeSelect.value=it.type;genreInput.value=it.genre;saveBtn.dataset.editId=it.id;saveBtn.textContent='Güncelle';};
        const b4=document.createElement('button');b4.textContent='Sil';b4.onclick=()=>deleteItem(it.id);
        actions.append(b1,b2,b3,b4);
        row.append(left,badge,actions);
        mainList.appendChild(row);
      });
    }
  </script>
</body>
</html>
